
## BranchPredict: CPU Emulator & Dynamic Branch Prediction Analysis

### 1\. Overview

**BranchPredict** is a dedicated software CPU emulator designed for the quantitative analysis and comparison of dynamic branch prediction algorithms. The tool executes RV32IM programs and generates detailed metrics to evaluate prediction performance across different methodologies.

The primary objective is to provide a clear, evidence-based comparison between established prediction techniques, including Gshare, GAg, PAg, and a simple baseline predictor.

-----

### 2\. Getting Started

#### Prerequisites

  * A C++ compiler supporting the **C++14 standard** or later (e.g., GCC).

#### Building the Project

1.  Clone the repository using the provided URL:
    ```bash
    git clone https://github.com/f3rhd/branchpredict
    cd branchpredict
    ```
2.  Compile the source files using the C++14 standard:
    ```bash
    g++ -std=c++14 main.cpp cpu/*.cpp parser/*.cpp -w -o cpu
    ```

-----

### 3\. Usage

The compiled program (`./cpu`) is executed via the command line, requiring an input assembly file and configuration flags for logging and the chosen branch prediction algorithm.

#### Syntax

```bash
./cpu <input.s> [OPTIONS]
```

#### Command Line Options

| Option | Category | Description |
| :--- | :--- | :--- |
| **`<input.s>`** | **Required Input** | Path to the RV32IM assembly source file for simulation. |
| `--log cout` | Logging Target | Outputs simulation metrics and statistics directly to the terminal (`std::cout`). |
| `--log <filename>` | Logging Target | Outputs metrics to the specified file for later analysis (e.g., `results.csv`). |
| `--gshare` | Predictor Selection | Uses the **Gshare** predictor. **(Default)** |
| `--GAg` | Predictor Selection | Uses the **GAg** (Global History, Global PHT) predictor. |
| `--PAg` | Predictor Selection | Uses the **PAg** (Per-Address History, Global PHT) predictor. |
| `--simple` | Predictor Selection | Uses a **Simple** baseline predictor (e.g., 2 bit saturating counter). |

#### Examples

| Command | Description |
| :--- | :--- |
| `./cpu benchmark_1.s --GAg --log cout` | Analyze `benchmark_1.s` using the GAg method, outputting results to the console. |
| `./cpu test_loop.s --PAg --log pag_run_metrics.txt` | Simulate `test_loop.s` using the PAg method and save the detailed metrics to a file. |

-----

### 4\. Branch Predictor Mechanisms

The simulator supports and allows direct comparative analysis of the following dynamic prediction techniques:

| Predictor | Description | PHT Indexing Method |
| :--- | :--- | :--- |
| **Simple** | Baseline predictor, typically using a 2-bit counter| 
| **Gshare** | Uses the branch instruction ids  XORed with the contents of the **Global History Register (GHR)** to index the Pattern History Table (PHT). | GHR $\oplus$ BRANCH_ID $\rightarrow$ PHT Index |
| **GAg** | **Global History, Global PHT.** The GHR is used directly to index a single, shared PHT. | GHR $\rightarrow$ PHT Index |
| **PAg** | **Per-Address History, Global PHT.** Each branch uses its own **Local History Register (LHR)** to index the PHT. | LHR $\rightarrow$ PHT Index |

-----

### 5\. Metrics

The output generated by the simulator provides quantitative measures used to determine the efficiency of the prediction algorithm under test. 

| Metric | Calculation / Description | Significance |
| :--- | :--- | :--- |
| **Total Branches** | Total count of all conditional and unconditional branch instructions executed during the simulation. | Context for the total number of prediction events. |
| **Prediction Accuracy** | $\frac{\text{Correct Predictions}}{\text{Total Branches}} \times 100\%$ | **Primary comparative metric.** Directly correlates with the predictor's effectiveness. |
| **Mispredictions** | Absolute number of incorrect branch outcome guesses. | Each misprediction incurs a simulation pipeline penalty. |
| **Register File** | Shows the final stage of the register file | For fun. | 
| **Total Cost Units (Cycles)**| 	The simulated execution overhead. Calculated by applying a defined penalty (e.g., 3 units) for every mispredicted branch.	Minimization Target. | The predictor yielding the lowest cost is the most efficient. | 

-----

### 6\. Repository Structure

The project codebase is organized by functionality:

  * `main.cpp`: Manages command line arguments, project initialization, and the primary simulation loop control.
  * `CPU.hpp`/`.cpp`: Contains the core execution unit, register file management, memory model, and the templated `PREDICTOR_TYPE` implementation.
  * `parser_t.hpp`/`.cpp`: Implements logic for parsing the input assembly (`.s`) files into the simulator's internal program representation.

-----

### 7\. License

This project is licensed under the MIT License. Refer to the `LICENSE.md` file for complete details.
